{%- from "ntp/map.jinja" import client with context -%}
local_ntp_service_proc:
  command: "PATH=$PATH:/usr/lib64/nagios/plugins:/usr/lib/nagios/plugins check_procs -a '/usr/sbin/ntpd' -u ntp -c 1:1"
  interval: 300
  occurrences: 1
  subscribers:
  - local-ntp-client
  - local-ntp-server
{%- for stratum in client.get('strata', []) %}
local_ntp_client_time_{{ stratum }}:
  command: "PATH=:/usr/lib64/nagios/plugins:/usr/lib/nagios/plugins check_ntp_time -q -H {{ stratum }} -w 0.2 -c 2"
  interval: 3600
  occurrences: 10
  subscribers:
  - local-ntp-client
{%- endfor %}